<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>à¸£à¸°à¸šà¸šà¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸£à¸¸à¸ à¸±à¸“à¸‘à¹Œ</title>
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <header>
    <div class="logo">logo</div>
    <h1>à¸£à¸°à¸šà¸šà¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸£à¸¸à¸ à¸±à¸“à¸‘à¹Œ</h1>
    <button class="login-btn">LOGIN</button>
  </header>

  <main>
    <section class="table-section">
      <div class="table-header">
        <h2>à¸Šà¸·à¹ˆà¸­ à¸„à¸£à¸¸à¸ à¸±à¸“à¸‘à¹Œ</h2>
        <div class="search-box">
          <input type="text" id="search" placeholder="ðŸ” à¸„à¹‰à¸™à¸«à¸²à¸„à¸£à¸¸à¸ à¸±à¸“à¸‘à¹Œ...">
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>à¸§à¸±à¸™à¸—à¸µà¹ˆ</th>
            <th>à¸Šà¸·à¹ˆà¸­à¸„à¸£à¸¸à¸ à¸±à¸“à¸‘à¹Œ</th>
            <th>Status</th>
            <th>à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸</th>
          </tr>
        </thead>
        <tbody id="data-table"></tbody>
      </table>
    </section>
  </main>

  <script>
    const sheetID = "1bkpz-iG4B8qnvZc4ql4qE15Qw8HrIZ1aeX1vZQzMFy0";
    const sheetName = "SHOW";
    const baseURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&sheet=${sheetName}&t=${Date.now()}`;

    const tableBody = document.querySelector("#equipmentTable tbody");
    const searchInput = document.getElementById("searchInput");
    const modal = document.getElementById("modal");
    const closeModal = document.getElementById("closeModal");
    const modalDetails = document.getElementById("modalDetails");
    const sortBtn = document.getElementById("sortBtn");

    let data = [];
    let ascending = true; // à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹€à¸£à¸µà¸¢à¸‡à¸ˆà¸²à¸à¸™à¹‰à¸­à¸¢à¹„à¸›à¸¡à¸²à¸

    async function loadEquipment() {
      try {
        const res = await fetch(baseURL);
        const text = await res.text();
        const json = JSON.parse(text.substring(47).slice(0, -2));
        data = json.table.rows.map(r => ({
          number: r.c[0]?.v,
          code: r.c[1]?.v,
          name: r.c[2]?.v,
          location: r.c[3]?.v,
          status: r.c[4]?.v,
          details: r.c[5]?.v
        }));

        renderTable();
      } catch (error) {
        console.error("à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ:", error);
      }
    }

    // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
    function renderTable(rows) {
      const tbody = document.getElementById("data-table");
      tbody.innerHTML = "";
      rows.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row[0]}</td>
          <td><a href="detail.html?id=${row[1]}">${row[2]}</a></td>
          <td>${row[3]}</td>
          <td>${row[4] || "-"}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸„à¹‰à¸™à¸«à¸²
    document.getElementById("search").addEventListener("keyup", (e) => {
      const keyword = e.target.value.toLowerCase();
      const filtered = allRows.filter(row => 
        row.some(cell => cell && cell.toString().toLowerCase().includes(keyword))
      );
      renderTable(filtered);
    });
  </script>
</body>
</html>
