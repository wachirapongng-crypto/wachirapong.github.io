<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ระบบตรวจสอบครุภัณฑ์</title>
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <header>
    <div class="logo">logo</div>
    <h1>ระบบตรวจสอบครุภัณฑ์</h1>
    <button class="login-btn">LOGIN</button>
  </header>

  <main>
    <section class="table-section">
      <div class="table-header">
        <h2>ชื่อ ครุภัณฑ์</h2>
        <div class="search-box">
          <input type="text" id="search" placeholder="🔍 ค้นหาครุภัณฑ์...">
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>วันที่</th>
            <th>ชื่อครุภัณฑ์</th>
            <th>Status</th>
            <th>หมายเหตุ</th>
          </tr>
        </thead>
        <tbody id="data-table"></tbody>
      </table>
    </section>
  </main>

  <script>
    const sheetID = "1bkpz-iG4B8qnvZc4ql4qE15Qw8HrIZ1aeX1vZQzMFy0";
    const sheetName = "SHOW";
    const baseURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;

    let allRows = [];

    fetch(baseURL)
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const rows = json.table.rows.map(r => r.c.map(c => (c ? c.v : "")));
        allRows = rows.slice(1);
        renderTable(allRows);
      });

    // ฟังก์ชันแสดงข้อมูล
    function renderTable(rows) {
      const tbody = document.getElementById("data-table");
      tbody.innerHTML = "";
      rows.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row[0]}</td>
          <td><a href="detail.html?id=${row[1]}">${row[2]}</a></td>
          <td>${row[3]}</td>
          <td>${row[4] || "-"}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ฟังก์ชันค้นหา
    document.getElementById("search").addEventListener("keyup", (e) => {
      const keyword = e.target.value.toLowerCase();
      const filtered = allRows.filter(row => 
        row.some(cell => cell && cell.toString().toLowerCase().includes(keyword))
      );
      renderTable(filtered);
    });
  </script>
</body>
</html>
